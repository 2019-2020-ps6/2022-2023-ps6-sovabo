{"version":3,"sources":["../src/angularTemplate.js"],"names":["ensureScopeAvailable","reactAngularModule","provideAngularScopeHOC","isCustomComponent","tagName","props","indexOf","is","link","$scope","$element","args","data","debugInfoEnabled","usesNgReact","raModule","module","config","$compileProvider","bind","value","directive","$elem","decorator","$delegate","run","reactAngularProductionReady","ReactAngular","controller","controllerAs","inject","isolate","scope","template","templateUrl","context","console","warn","parentScope","$injector","injector","$controller","get","$compile","$rootScope","$templateCache","$new","isObject","extend","actualTemplateFunc","actualTemplate","isFunction","instantiatedController","append","$evalAsync","wrapperTag","className","wrapperAttrs","children","ref","element","isValidElement","Error","length","map","type","join","classesKey","classes","trim","undefined","child","cloneElement","createElement","Component","propTypes","string","node","any","object","bool","oneOfType","func","defaultProps","CONTEXT_TYPES","contextTypes","Wrapped","wrappedName","displayName","name","wrapperName","Wrapper","childContextTypes"],"mappings":"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","file":"angularTemplate.js","sourcesContent":["import React, { Component } from 'react';\nimport t from 'prop-types';\nimport angular from 'angular';\n\n// Stolen from ReactCOMComponent (it does not expose it)\nfunction isCustomComponent(tagName, props) {\n  return tagName.indexOf('-') >= 0 || props.is != null;\n}\n\n// Make sure the scope is defined when $compileProvider.debugInfoEnabled is false\nexport function ensureScopeAvailable(link) {\n  return function ($scope, $element, ...args) {\n    link && link($scope, $element, ...args);\n    $element.data('$scope', $scope);\n  };\n}\n\nlet debugInfoEnabled = null;\n\nexport function reactAngularModule(usesNgReact = true) {\n  const raModule = angular.module('react-angular', usesNgReact ? ['react'] : [])\n    .config([\n      '$compileProvider', ($compileProvider) => {\n        debugInfoEnabled = $compileProvider.debugInfoEnabled.bind($compileProvider);\n      },\n    ])\n    .value('reactAngularProductionReady', () => debugInfoEnabled = () => false);\n\n  if (usesNgReact) {\n    raModule\n      .directive('reactComponent', () => ($scope, $elem) => {\n        $elem.data('$scope', $scope)\n      })\n      .decorator('reactDirective', [\n        '$delegate', ($delegate) => (...args) => {\n          const directive = $delegate(...args);\n\n          return {\n            ...directive,\n            link: ensureScopeAvailable(directive.link),\n          };\n        }\n      ])\n      .run(['reactAngularProductionReady', (reactAngularProductionReady) => reactAngularProductionReady()]);\n  }\n\n  return raModule;\n}\n\nexport default class ReactAngular extends React.Component {\n  componentDidMount() {\n    const { controller, controllerAs, inject, isolate, scope, template, templateUrl } = this.props;\n\n    if (!this.context.$scope && !debugInfoEnabled) {\n      console.warn(\n        '[react-angular] It looks like you have not added the react-angular module to your dependencies.',\n        `Check react-angular documentation, section 'Running in production'.`\n      );\n    }\n    if (!this.context.$scope && debugInfoEnabled && debugInfoEnabled()) {\n      console.warn(\n        '[react-angular] It looks like you have declared that you are not using ngReact.',\n        'You should use either provideAngularScopeHOC(), or ensureScopeAvailable().',\n        `If you are using ensureScopeAvailable() and you don't want to see this warning again, call the reactAngularProductionReady() service in your module's init() block.`,\n        `Check react-angular documentation, section 'Running in production'.`\n      );\n    }\n\n    const parentScope = this.context.$scope || this.$element.scope();\n    const $injector = this.$element.injector();\n\n    const $controller = $injector.get('$controller');\n    const $compile = $injector.get('$compile');\n    const $rootScope = $injector.get('$rootScope');\n    const $templateCache = $injector.get('$templateCache');\n\n    this.$scope = scope ? parentScope.$new(isolate) : parentScope;\n\n    if (angular.isObject(scope)) {\n      angular.extend(this.$scope, scope);\n    }\n\n    const actualTemplateFunc = template || (templateUrl ? $templateCache.get(templateUrl) : null);\n\n    const actualTemplate = angular.isFunction(actualTemplateFunc)\n      ? actualTemplateFunc(inject)\n      : actualTemplateFunc;\n\n    if (controller) {\n      const instantiatedController = $controller(controller, {\n        ...inject,\n        $scope: this.$scope,\n        $element: this.$element,\n      });\n\n      if (controllerAs) {\n        this.$scope[controllerAs] = instantiatedController;\n      }\n    }\n\n    if (actualTemplate) {\n      this.$element.append(actualTemplate);\n    }\n\n    $compile(this.$element)(this.$scope);\n    this.$element.data('$scope', this.$scope);\n    $rootScope.$evalAsync();\n  }\n\n  shouldComponentUpdate() {\n    return false;\n  }\n\n  render() {\n    const { wrapperTag, className, wrapperAttrs, children } = this.props;\n    const ref = (element) => this.$element = angular.element(element);\n\n    if (children) {\n      if (!React.isValidElement(children)) {\n        throw new Error(`Only one child is allowed in AngularTemplate.\n          Found ${children.length}: ${children.map(({ type }) => type).join(', ')}.`);\n      }\n\n      const classesKey = isCustomComponent(children.type, children.props) ? 'class' : 'className';\n      const classes = {\n        [classesKey]: [className || '', children.props.className || '', children.props['class'] || '']\n          .join(' ')\n          .trim() || undefined,\n      };\n\n      const child = React.cloneElement(children, {\n        ...wrapperAttrs,\n        ref,\n        ...classes,\n      });\n\n      return child;\n    }\n\n    const classesKey = isCustomComponent(wrapperTag, wrapperAttrs) ? 'class' : 'className';\n    const classes = {\n      [classesKey]: [className || '', wrapperAttrs.className || '', wrapperAttrs['class'] || '']\n        .join(' ')\n        .trim() || undefined,\n    };\n\n    return React.createElement(wrapperTag, {\n      ...wrapperAttrs,\n      ref,\n      ...classes,\n    }, '');\n  }\n}\n\nReactAngular.propTypes = {\n  className: t.string,\n  children: t.node,\n  controller: t.any,\n  controllerAs: t.string,\n  inject: t.object,\n  isolate: t.bool,\n  scope: t.oneOfType([t.bool, t.object]),\n  template: t.oneOfType([t.string, t.func]),\n  templateUrl: t.string,\n  wrapperTag: t.string,\n  wrapperAttrs: t.object,\n};\n\nReactAngular.defaultProps = {\n  inject: {},\n  isolate: false,\n  scope: true,\n  wrapperTag: 'div',\n  wrapperAttrs: {},\n};\n\nconst CONTEXT_TYPES = {\n  $scope: t.any,\n};\n\nReactAngular.contextTypes = CONTEXT_TYPES;\n\nexport function provideAngularScopeHOC(Wrapped) {\n  const wrappedName = Wrapped.displayName || Wrapped.name;\n  const wrapperName = `ProvideAngularScope (${wrappedName})`;\n\n  class Wrapper extends Component {\n    getChildContext() {\n      return {\n        $scope: this.props.$scope,\n      };\n    }\n\n    render() {\n      const { $scope, ...props } = this.props;\n\n      if (!$scope) {\n        throw new Error(`Angular scope was not passed as the $scope prop to ${wrapperName}.`);\n      }\n\n      return (\n        <Wrapped {...props} />\n      );\n    }\n  }\n\n  Wrapper.childContextTypes = CONTEXT_TYPES;\n  Wrapper.propTypes = {\n    ...(Wrapped.propTypes || {}),\n    ...CONTEXT_TYPES,\n  };\n\n  return Wrapper;\n}\n"]}